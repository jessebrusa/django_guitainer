{% extends 'base/main.html' %}

{% block content %}
    <h1>Guitainer</h1>
    <hr>
    <ul>
        {% for song in song_list %}
            <li data-song-id="{{ song.id }}">
                <p>Title: {{ song.title }}</p>
                <p>Artist: {{ song.artist }}</p>
                <p><img src="{{ song.songurl.img }}" alt="picture of song from google"></p>
                <p><a href="{% url 'song_detail' song.id %}">View Song</a></p>
                <button class="remove-from-library" data-song-id="{{ song.id }}">Remove From Library</button>
                <hr>
            </li>
        {% endfor %}
    </ul>

    <script>
        document.querySelectorAll('.remove-from-library').forEach(function(button) {
            button.addEventListener('click', function() {
                var songId = this.dataset.songId;
                fetch('/remove-from-library/' + songId + '/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({})
                }).then(function(response) {
                    return response.json();
                }).then(function(data) {
                    if (data.status === 'success') {
                        var songElement = document.querySelector('[data-song-id="' + songId + '"]');
                        songElement.remove();
                    }
                });
            });
        });
    </script>
{% endblock %}
