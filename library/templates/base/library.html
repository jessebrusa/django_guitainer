{% extends 'base/main.html' %}

{% block content %}
    <h1>Guitainer</h1>
    <hr>
    <ul>
        {% for song in song_list %}
            <li>Title: {{ song.title }}</li>
            <li>Artist: {{ song.artist }}</li>
            <li><img src="{{ song.songurl.img }}" alt="picture of song from google"></li>
            <li><a href="{% url 'song_detail' song.id %}">View Song</a></li>
            <button class="remove-from-library" data-song-id="{{ song.id }}">Remove From Library</button>
            <hr>
        {% endfor %}
    </ul>

    <script>
        document.querySelectorAll('.remove-from-library').forEach(function(button) {
            button.addEventListener('click', function() {
                var songId = this.dataset.songId;
                fetch('/remove-from-library/' + songId + '/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({})
                }).then(function(response) {
                    return response.json();
                }).then(function(data) {
                    if (data.status === 'success') {
                        alert('Song Removed from Library!');
                    }
                });
            });
        });
    </script>
{% endblock %}
