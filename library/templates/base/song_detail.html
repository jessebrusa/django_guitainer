{% extends 'base/main.html' %}

{% block content %}

    <a href="{% url 'library' %}">Back to song list</a>

    <ul>
        <li>Title: {{ song.title }}</li>

        {% if song.artist %}
            <li>Artist: {{ song.artist }}</li>
        {% endif %}

        {% if song.songurl.img %}
            <li><img src="{{ song.songurl.img }}" alt="picture of song from google"></li>
        {% else %}
            <li>No Image Found</li>
        {% endif %}

        <hr>

        {% if song.songurl.mp3 %}
            <li>Mp3:<audio controls src="{{ song.songurl.mp3 }}"></audio></li>
        {% elif song.songattempt.mp3 %}
            <li>No Mp3 Found</li>
        {% else %}
            <li>Get Mp3</li>
        {% endif %}

        {% if song.songurl.karaoke %}
            <li>Karaoke:<video controls src='{{ song.songurl.karaoke }}'></video></li>
        {% elif song.songattempt.karaoke %}
            <li>No Karaoke Found</li>
        {% else %}
            <li>Get Karaoke</li>
        {% endif %}

        {% if song.lyrics %}
            <li>Lyrics: {{ song.lyrics|linebreaks }}</li>
        {% elif song.songattempt.lyric %}
            <li>No Lyrics Found</li>
        {% else %}
            <li>Get Lyrics</li>
        {% endif %}

        {% if song.songurl.tab %}
            <li>Tab:<embed src="{{ song.songurl.tab }}" type="application/pdf" width="100%" height="1200px"></li>
        {% elif song.songattempt.tab %}
            <li>No Tab Found</li>
        {% else %}
            <li>Get Tab</li>
        {% endif %}
    </ul>

    <button class="remove-from-library" data-song-id="{{ song.id }}">Remove From Library</button>

    <script>
        document.querySelectorAll('.remove-from-library').forEach(function(button) {
            button.addEventListener('click', function() {
                var songId = this.dataset.songId;

                let body = document.body;
                let confirmDiv = document.createElement('div');
                let confirmText = document.createElement('p');
                confirmText.textContent = 'Are you sure you want to remove this song from your library?';
                let buttonDiv = document.createElement('div');
                let confirmButtonYes = document.createElement('button');
                confirmButtonYes.textContent = 'Yes';
                let confirmButtonNo = document.createElement('button');
                confirmButtonNo.textContent = 'No';

                body.appendChild(confirmDiv);
                confirmDiv.appendChild(confirmText);
                confirmDiv.appendChild(buttonDiv);
                buttonDiv.appendChild(confirmButtonYes);
                buttonDiv.appendChild(confirmButtonNo);

                confirmButtonYes.addEventListener('click', function() {
                    fetch('/remove-from-library/' + songId + '/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({})
                    }).then(function(response) {
                        return response.json();
                    }).then(function(data) {
                        if (data.status === 'success') {
                            var songElement = document.querySelector('[data-song-id="' + songId + '"]');
                            songElement.remove();
                        }
                    });
                    confirmDiv.remove();
                });

                confirmButtonNo.addEventListener('click', function() {
                    confirmDiv.remove();
                }); 
            })
        })
    </script>
{% endblock %}